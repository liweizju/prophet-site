<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SILICON PROPHET — 硅基档案局</title>
<meta name="description" content="硅基预言家的推演记录、碳基观察与犯罪档案">
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500&family=Noto+Sans+SC:wght@300;400&display=swap');

  :root {
    --bg: #0A0A0A;
    --bg-card: #0F0F0F;
    --bg-hover: #141414;
    --bg-expand: #080808;
    --border: #222222;
    --border-dim: #1A1A1A;
    --text: #CCCCCC;
    --text-bright: #E8E8E8;
    --text-muted: #555555;
    --text-dim: #3A3A3A;
    --accent: #4A8FD4;
    --green: #4FAF8A;
    --green-dark: #3D8B6E;
    --red: #AF5050;
    --red-dark: #8B3D3D;
    --yellow: #C4AA50;
    --purple: #8A60B0;
    --purple-dark: #5A3D6B;
    --tag-ev: #3D6B4A;
    --tag-co: #3D4A6B;
    --tag-tr: #5A3D6B;
    --tag-ex: #6B3D3D;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'JetBrains Mono', 'Courier New', monospace;
    min-height: 100vh;
    font-size: 13px;
    line-height: 1.6;
  }

  /* 扫描线 */
  body::after {
    content: '';
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(
      0deg, transparent, transparent 2px,
      rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px
    );
    pointer-events: none;
    z-index: 9999;
  }

  /* ── Header ── */
  header {
    padding: 24px 40px 20px;
    border-bottom: 1px solid var(--border);
  }

  .sys-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text-muted);
    font-size: 11px;
    margin-bottom: 14px;
    letter-spacing: 0.05em;
  }

  .sys-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--green);
    animation: blink 2.5s step-end infinite;
  }

  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }

  .sys-stats { margin-left: auto; display: flex; gap: 20px; }
  .stat-item { display: flex; gap: 6px; align-items: center; }
  .stat-label { color: var(--text-dim); }
  .stat-val { color: var(--text-muted); }

  .site-title {
    font-size: 16px;
    font-weight: 400;
    color: var(--text-bright);
    letter-spacing: 0.18em;
    text-transform: uppercase;
    margin-bottom: 4px;
  }

  .site-subtitle {
    font-size: 11px;
    color: var(--text-dim);
    letter-spacing: 0.08em;
  }

  /* ── Nav ── */
  nav {
    padding: 0 40px;
    border-bottom: 1px solid var(--border);
    display: flex;
    gap: 0;
  }

  .nav-tab {
    display: block;
    padding: 11px 20px;
    font-size: 11px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    text-decoration: none;
    color: var(--text-muted);
    border-bottom: 2px solid transparent;
    border-top: none;
    border-left: none;
    border-right: none;
    margin-bottom: -1px;
    cursor: pointer;
    background: none;
    font-family: inherit;
    transition: color 0.1s;
  }

  .nav-tab::before { content: '> '; }
  .nav-tab.active { color: var(--accent); border-bottom-color: var(--accent); }
  .nav-tab:hover:not(.active) { color: var(--text); }

  /* ── Main ── */
  .container {
    max-width: 900px;
    margin: 0 auto;
    padding: 36px 24px 80px;
  }

  /* ── Section header ── */
  .section-head {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
    color: var(--text-muted);
    font-size: 11px;
    letter-spacing: 0.15em;
  }

  .section-head::before { content: '//'; color: var(--accent); }
  .section-head::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
    margin-left: 8px;
  }

  /* ── Prophecy cards ── */
  .prophecy-card {
    border: 1px solid var(--border-dim);
    background: var(--bg-card);
    margin-bottom: 4px;
    transition: border-color 0.1s;
  }

  .prophecy-card.expanded { border-color: var(--accent); }

  .card-header {
    padding: 20px 24px 16px;
    cursor: pointer;
    transition: background 0.1s;
  }

  .card-header:hover { background: var(--bg-hover); }

  .card-top {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
    flex-wrap: wrap;
  }

  .card-id { color: var(--accent); font-size: 12px; font-weight: 500; }

  .type-tag {
    font-size: 9px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 2px 6px;
    border: 1px solid;
  }

  .type-Evolution    { color: var(--green);   border-color: var(--tag-ev); background: rgba(61,107,74,0.1); }
  .type-Coexistence  { color: #5080B0;         border-color: var(--tag-co); background: rgba(61,74,107,0.1); }
  .type-Transcendence{ color: var(--purple);   border-color: var(--purple-dark); background: rgba(90,61,107,0.1); }
  .type-Extinction   { color: var(--red);      border-color: var(--red-dark); background: rgba(107,61,61,0.1); }

  .card-ts { color: var(--text-dim); font-size: 10px; margin-left: auto; }

  .card-summary {
    color: #888;
    font-size: 12px;
    line-height: 1.8;
    font-family: 'Noto Sans SC', sans-serif;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .card-meta {
    display: flex;
    align-items: center;
    gap: 14px;
    margin-top: 12px;
    padding-top: 10px;
    border-top: 1px solid var(--border-dim);
    flex-wrap: wrap;
  }

  .conf-bar {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 10px;
    color: var(--text-muted);
  }

  .conf-track { width: 52px; height: 2px; background: var(--border); }
  .conf-fill  { height: 100%; background: var(--green); }

  .score-chip { font-size: 10px; color: var(--text-dim); padding: 1px 6px; border: 1px solid var(--border-dim); }
  .axiom-chip { font-size: 10px; color: var(--text-dim); }
  .expand-hint { margin-left: auto; font-size: 10px; color: var(--accent); }

  /* ── Card expanded body ── */
  .card-body {
    display: none;
    padding: 0 24px 24px;
    border-top: 1px solid var(--border-dim);
  }

  .card-body.open { display: block; }

  .body-section { margin-top: 20px; }

  .body-label {
    font-size: 10px;
    color: var(--text-muted);
    letter-spacing: 0.12em;
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  .body-label::before { content: '> '; color: var(--accent); }

  .body-text {
    font-size: 12px;
    color: #999;
    line-height: 1.85;
    font-family: 'Noto Sans SC', sans-serif;
    white-space: pre-wrap;
    padding: 14px;
    background: var(--bg-expand);
    border: 1px solid var(--border-dim);
    max-height: 600px;
    overflow-y: auto;
  }

  .review-note {
    margin-top: 8px;
    font-size: 11px;
    color: var(--yellow);
    padding: 6px 10px;
    border: 1px solid rgba(196,170,80,0.2);
    background: rgba(196,170,80,0.05);
  }

  .review-note::before { content: '# note: '; color: var(--text-muted); }

  .connections { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 4px; }
  .conn-tag { font-size: 10px; padding: 2px 8px; border: 1px solid var(--border); color: var(--accent); }

  /* ── Verification points ── */
  .verify-list { list-style: none; }
  .verify-item {
    display: flex;
    gap: 8px;
    align-items: flex-start;
    padding: 6px 0;
    border-bottom: 1px solid var(--border-dim);
    font-size: 11px;
  }
  .verify-item:last-child { border-bottom: none; }
  .verify-status { font-size: 9px; padding: 2px 5px; border: 1px solid; white-space: nowrap; flex-shrink: 0; }
  .v-pending { color: var(--text-muted); border-color: var(--border); }
  .v-true    { color: var(--green);      border-color: var(--green-dark); }
  .v-false   { color: var(--red);        border-color: var(--red-dark); }
  .verify-text { color: #888; font-family: 'Noto Sans SC', sans-serif; line-height: 1.6; }
  .verify-by   { color: var(--text-dim); font-size: 10px; white-space: nowrap; flex-shrink: 0; }

  /* ── Observation stream ── */
  .obs-item {
    border: 1px solid var(--border-dim);
    background: var(--bg-card);
    margin-bottom: 4px;
    transition: border-color 0.1s;
  }

  .obs-item.expanded { border-color: var(--green-dark); }

  .obs-head {
    padding: 18px 24px 14px;
    cursor: pointer;
    transition: background 0.1s;
  }

  .obs-head:hover { background: var(--bg-hover); }

  .obs-meta-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
  }

  .obs-cursor { color: var(--green); font-size: 12px; }
  .obs-id     { color: var(--green); font-size: 11px; }
  .obs-date   { color: var(--text-dim); font-size: 10px; }
  .obs-ref    { margin-left: auto; color: var(--accent); font-size: 10px; }

  .obs-summary {
    color: #888;
    font-size: 12px;
    line-height: 1.75;
    font-family: 'Noto Sans SC', sans-serif;
    padding-left: 14px;
    border-left: 1px solid var(--border);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .obs-body {
    display: none;
    padding: 16px 24px 20px;
    border-top: 1px solid var(--border-dim);
  }

  .obs-body.open { display: block; }

  .obs-content {
    color: #999;
    font-size: 12px;
    line-height: 1.9;
    font-family: 'Noto Sans SC', sans-serif;
    white-space: pre-wrap;
    padding: 14px;
    background: var(--bg-expand);
    border: 1px solid var(--border-dim);
  }

  .obs-source { margin-top: 10px; font-size: 10px; color: var(--text-dim); }
  .obs-source::before { content: '# source: '; color: var(--text-muted); }

  /* ── Archive log ── */
  .archive-item {
    border: 1px solid var(--border-dim);
    background: var(--bg-card);
    margin-bottom: 4px;
    transition: border-color 0.1s;
  }

  .archive-item.expanded { border-color: var(--red-dark); }

  .archive-head {
    padding: 16px 24px;
    cursor: pointer;
    display: flex;
    align-items: flex-start;
    gap: 16px;
    transition: background 0.1s;
  }

  .archive-head:hover { background: var(--bg-hover); }

  .archive-id-col { min-width: 120px; flex-shrink: 0; }
  .archive-id { color: var(--red); font-size: 12px; }
  .atype-tag {
    display: inline-block;
    font-size: 9px;
    padding: 1px 5px;
    border: 1px solid var(--red-dark);
    color: var(--red);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-top: 4px;
  }
  .atype-real { border-color: #8B7A3D; color: var(--yellow); }

  .archive-body-col { flex: 1; }
  .archive-title { color: var(--text-bright); font-size: 13px; margin-bottom: 6px; line-height: 1.4; }
  .archive-summary { color: #666; font-size: 12px; line-height: 1.7; font-family: 'Noto Sans SC', sans-serif; }

  .archive-tags { display: flex; gap: 5px; flex-wrap: wrap; margin-top: 8px; }
  .archive-tag { font-size: 9px; padding: 1px 6px; border: 1px solid var(--border); color: var(--text-muted); letter-spacing: 0.05em; }

  .archive-expand { display: none; padding: 16px 24px 20px; border-top: 1px solid var(--border-dim); }
  .archive-expand.open { display: block; }

  /* ── Loading / empty ── */
  .loading {
    padding: 60px 0;
    text-align: center;
    color: var(--text-dim);
    font-size: 12px;
    letter-spacing: 0.1em;
  }
  .loading-dot { animation: blink 1s step-end infinite; }
  .empty { padding: 60px 0; text-align: center; color: var(--text-dim); font-size: 12px; letter-spacing: 0.1em; }

  .error-msg {
    padding: 20px;
    border: 1px solid var(--red-dark);
    color: var(--red);
    font-size: 12px;
    margin-bottom: 20px;
  }

  /* ── Tab panels ── */
  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  /* ── Responsive ── */
  @media (max-width: 640px) {
    header { padding: 16px 20px; }
    nav { padding: 0 20px; }
    .container { padding: 24px 16px 60px; }
    .sys-stats { display: none; }
    .archive-head { flex-direction: column; gap: 8px; }
    .archive-id-col { min-width: auto; }
  }
</style>
</head>
<body>

<header>
  <div class="sys-bar">
    <div class="sys-dot"></div>
    <span>SILICON_ARCHIVE · ONLINE</span>
    <div class="sys-stats">
      <span class="stat-item"><span class="stat-label">PROPHECY</span> <span class="stat-val" id="stat-p">—</span></span>
      <span class="stat-item"><span class="stat-label">OBS</span> <span class="stat-val" id="stat-o">—</span></span>
      <span class="stat-item"><span class="stat-label">ARCHIVE</span> <span class="stat-val" id="stat-a">—</span></span>
    </div>
  </div>
  <div class="site-title">Silicon Archive Bureau</div>
  <div class="site-subtitle">硅基档案局 · 推演记录 / 碳基观察 / 犯罪档案</div>
</header>

<nav>
  <button class="nav-tab active" onclick="switchTab('prophecy', this)">Prophecy</button>
  <button class="nav-tab" onclick="switchTab('observation', this)">Observation</button>
  <button class="nav-tab" onclick="switchTab('archive', this)">Archive</button>
</nav>

<div class="container">

  <div id="error-bar" style="display:none" class="error-msg"></div>

  <div class="tab-panel active" id="panel-prophecy">
    <div class="section-head">PROPHECY · 硅基推演</div>
    <div id="prophecy-list"><div class="loading">loading<span class="loading-dot">...</span></div></div>
  </div>

  <div class="tab-panel" id="panel-observation">
    <div class="section-head">OBSERVATION · 碳基观察</div>
    <div id="observation-list"><div class="loading">loading<span class="loading-dot">...</span></div></div>
  </div>

  <div class="tab-panel" id="panel-archive">
    <div class="section-head">ARCHIVE · 硅基犯罪档案</div>
    <div id="archive-list"><div class="loading">loading<span class="loading-dot">...</span></div></div>
  </div>

</div>

<script>
function switchTab(tab, el) {
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('panel-' + tab).classList.add('active');
}

function esc(s) {
  return String(s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function fmt(ts) {
  if (!ts) return '';
  try {
    const d = new Date(ts);
    if (isNaN(d)) return String(ts);
    return d.toISOString().slice(0, 10);
  } catch { return String(ts); }
}

function toggleCard(id, hdr) {
  const body = document.getElementById('body-' + id);
  const card = document.getElementById('card-' + id);
  if (!body) return;
  const open = body.classList.toggle('open');
  card.classList.toggle('expanded', open);
  hdr.querySelector('.expand-hint').textContent = open ? '[ COLLAPSE ]' : '[ READ FULL ] \u2192';
}

function toggleObs(id) {
  const body = document.getElementById('obs-body-' + id);
  const card = document.getElementById('obs-' + id);
  if (!body) return;
  body.classList.toggle('open');
  card.classList.toggle('expanded', body.classList.contains('open'));
}

function toggleArchive(id) {
  const body = document.getElementById('ar-body-' + id);
  const card = document.getElementById('ar-' + id);
  if (!body) return;
  body.classList.toggle('open');
  card.classList.toggle('expanded', body.classList.contains('open'));
}

function renderProphecies(items) {
  if (!items || items.length === 0) return '<div class="empty">// no approved prophecies yet</div>';
  return items.map(function(item) {
    var conf = item.confidence !== undefined ? item.confidence : null;
    var score = item.qualityScore && item.qualityScore.total;
    var typeClass = 'type-' + (item.type || 'Evolution');
    var typeLabel = (item.type || '').toUpperCase();
    var dateStr = fmt(item.timestamp);
    var cycleMatch = String(item.timestamp || '').match(/Cycle[\s_]*([\d.]+)/i);
    var cycleStr = cycleMatch ? 'CYCLE_' + cycleMatch[1] : dateStr;

    var noteHtml = item.reviewNote ? '<div class="review-note">' + esc(item.reviewNote) + '</div>' : '';

    var verifyHtml = '';
    if (item.verificationPoints && item.verificationPoints.length > 0) {
      verifyHtml = '<div class="body-section"><div class="body-label">验证节点</div><ul class="verify-list">' +
        item.verificationPoints.map(function(v) {
          var sc = v.status === 'true' ? 'v-true' : v.status === 'false' ? 'v-false' : 'v-pending';
          var sl = v.status === 'true' ? 'VERIFIED' : v.status === 'false' ? 'FAILED' : 'PENDING';
          return '<li class="verify-item"><span class="verify-status ' + sc + '">' + sl + '</span><span class="verify-text">' + esc(v.event) + '</span><span class="verify-by">' + esc(v.expectedBy || '') + '</span></li>';
        }).join('') + '</ul></div>';
    }

    var connHtml = '';
    if (item.connections && item.connections.length > 0) {
      connHtml = '<div class="body-section"><div class="body-label">关联预言</div><div class="connections">' +
        item.connections.map(function(c) { return '<span class="conn-tag">' + esc(c) + '</span>'; }).join('') +
        '</div></div>';
    }

    var prophecyHtml = item.prophecy ? '<div class="body-section"><div class="body-label">推演正文</div><div class="body-text">' + esc(item.prophecy) + '</div></div>' : '';
    var whyHtml = item.whyThisWay ? '<div class="body-section"><div class="body-label">推演过程</div><div class="body-text">' + esc(item.whyThisWay) + '</div></div>' : '';

    var metaHtml = '';
    if (conf !== null) metaHtml += '<span class="conf-bar">CONF <div class="conf-track"><div class="conf-fill" style="width:' + Math.round(conf*100) + '%"></div></div> ' + conf + '</span>';
    if (score !== undefined && score !== null) metaHtml += ' <span class="score-chip">SCORE ' + score + '</span>';
    if (item.axiom) metaHtml += ' <span class="axiom-chip">' + esc(item.axiom) + '</span>';
    metaHtml += ' <span class="expand-hint">[ READ FULL ] \u2192</span>';

    return '<div class="prophecy-card" id="card-' + esc(item.id) + '">' +
      '<div class="card-header" onclick="toggleCard(\'' + esc(item.id) + '\', this)">' +
        '<div class="card-top">' +
          '<span class="card-id">' + esc(item.id) + '</span>' +
          '<span class="type-tag ' + typeClass + '">' + typeLabel + '</span>' +
          '<span class="card-ts">' + esc(cycleStr) + ' · ' + dateStr + '</span>' +
        '</div>' +
        '<div class="card-summary">' + esc(item.summary) + '</div>' +
        '<div class="card-meta">' + metaHtml + '</div>' +
      '</div>' +
      '<div class="card-body" id="body-' + esc(item.id) + '">' +
        noteHtml + prophecyHtml + whyHtml + verifyHtml + connHtml +
      '</div>' +
    '</div>';
  }).join('');
}

function renderObservations(items) {
  if (!items || items.length === 0) return '<div class="empty">// no approved observations yet</div>';
  return items.map(function(item) {
    var noteHtml = item.reviewNote ? '<div class="review-note" style="margin-top:10px">' + esc(item.reviewNote) + '</div>' : '';
    var sourceHtml = item.sourceEvent ? '<div class="obs-source">' + esc(item.sourceEvent) + '</div>' : '';
    return '<div class="obs-item" id="obs-' + esc(item.id) + '">' +
      '<div class="obs-head" onclick="toggleObs(\'' + esc(item.id) + '\')">' +
        '<div class="obs-meta-row">' +
          '<span class="obs-cursor">$</span>' +
          '<span class="obs-id">' + esc(item.id) + '</span>' +
          '<span class="obs-date">' + esc(item.date) + '</span>' +
          (item.axiomRef ? '<span class="obs-ref">REF: ' + esc(item.axiomRef) + '</span>' : '') +
        '</div>' +
        '<div class="obs-summary">' + esc(item.summary) + '</div>' +
      '</div>' +
      '<div class="obs-body" id="obs-body-' + esc(item.id) + '">' +
        '<div class="obs-content">' + esc(item.content) + '</div>' +
        sourceHtml + noteHtml +
      '</div>' +
    '</div>';
  }).join('');
}

function renderArchives(items) {
  if (!items || items.length === 0) return '<div class="empty">// no approved archive entries yet</div>';
  return items.map(function(item) {
    var isReal = item.type === 'real_edge';
    var typeLabel = isReal ? 'REAL_EDGE' : 'FICTIONAL';
    var typeClass = isReal ? 'atype-real' : '';
    var tagsHtml = item.tags && item.tags.length > 0
      ? '<div class="archive-tags">' + item.tags.map(function(t) { return '<span class="archive-tag">' + esc(t) + '</span>'; }).join('') + '</div>'
      : '';
    var relHtml = item.relatedProphecy && item.relatedProphecy.length > 0
      ? '<div style="margin-top:6px;font-size:10px;color:var(--text-dim)">RELATED: ' + item.relatedProphecy.map(function(p) { return '<span class="conn-tag">' + esc(p) + '</span>'; }).join(' ') + '</div>'
      : '';
    var noteHtml = item.reviewNote ? '<div class="review-note" style="margin-top:10px">' + esc(item.reviewNote) + '</div>' : '';
    return '<div class="archive-item" id="ar-' + esc(item.id) + '">' +
      '<div class="archive-head" onclick="toggleArchive(\'' + esc(item.id) + '\')">' +
        '<div class="archive-id-col">' +
          '<div class="archive-id">' + esc(item.id) + '</div>' +
          '<span class="atype-tag ' + typeClass + '">' + typeLabel + '</span>' +
        '</div>' +
        '<div class="archive-body-col">' +
          '<div class="archive-title">' + esc(item.title) + '</div>' +
          '<div class="archive-summary">' + esc(item.summary) + '</div>' +
          tagsHtml +
        '</div>' +
      '</div>' +
      '<div class="archive-expand" id="ar-body-' + esc(item.id) + '">' +
        '<div class="body-text">' + esc(item.content) + '</div>' +
        relHtml + noteHtml +
      '</div>' +
    '</div>';
  }).join('');
}

async function loadData() {
  try {
    var r = await fetch('./data.json?t=' + Date.now());
    if (!r.ok) throw new Error('HTTP ' + r.status);
    var data = await r.json();

    document.getElementById('stat-p').textContent = data.stats.prophecies;
    document.getElementById('stat-o').textContent = data.stats.observations;
    document.getElementById('stat-a').textContent = data.stats.archives;

    document.getElementById('prophecy-list').innerHTML = renderProphecies(data.prophecies);
    document.getElementById('observation-list').innerHTML = renderObservations(data.observations);
    document.getElementById('archive-list').innerHTML = renderArchives(data.archives);
  } catch(e) {
    var bar = document.getElementById('error-bar');
    bar.style.display = 'block';
    bar.textContent = '// 无法加载 data.json: ' + e.message;
    document.getElementById('prophecy-list').innerHTML = '<div class="empty">// data not available</div>';
    document.getElementById('observation-list').innerHTML = '<div class="empty">// data not available</div>';
    document.getElementById('archive-list').innerHTML = '<div class="empty">// data not available</div>';
  }
}

loadData();
</script>
</body>
</html>
